<html lang="es">
	<head>
		<link rel="stylesheet" type="text/css" href="estilo.css"/>
		<link href="jqueryuicss.css" rel="stylesheet" type="text/css" >
	</head>
	<body>
		<title>Puzzle de ordenamiento</title>
		<link href="bootstrap.css" rel="stylesheet" type="text/css" >



        <script src="jquery172.js"></script>
		<script src="jqueryui.js"></script>
		<script src="jqueryuitouchpunch.js"></script>
		<script src="jquerymjsnestedsortable.js"></script>
		<script src="skulptmin.js"></script>
		<script src="skulptstdlib.js"></script>
        <!--
		<script src="http://www.skulpt.org/static/skulpt.min.js" type="text/javascript"></script>
        <script src="http://www.skulpt.org/static/skulpt-stdlib.js" type="text/javascript"></script>
-->

        <div class="col-xs-12">
			<div class="row">
				<div class="col-xs-9">
					<h4 id="titulo"></h4>
					<div class="menu-box">
						<ul class="menu-list sortable ui-sortable" id="puzzle">
						</ul>
					</div>
				</div>
				<div class="col-xs-3">
					<h4>Salida:</h4>
					<textarea id="salida" class='form-control' disabled onchange='textAreaAdjust(this)' style="overflow:hidden"></textarea>
					<button id="serialize" class="btn btn-success form-control">He terminado</button>
				</div>
			</div>
			<div class="row">
				<pre id="toArrayOutput"></pre>
			</div>
			<div class="row">
				<pre id="toHierarchy"></pre>
			</div>
			<div class="row">
				<pre id="serialize"></pre>
			</div>
		</div>

		<script>

	var puzzle;
	var salida;
	var jsonLista;
    $(document).ready(function ()
    {
		salida=Android.getSalida();
		$("#titulo").html(Android.getTitulo());
		$("#salida").html(salida);
		textAreaAdjust(document.getElementById("salida"));
		jsonLista=JSON.parse((Android.createPuzzle()));
		for(i=1; i<=Object.keys(jsonLista.puzzle).length; i++)
			document.getElementById("puzzle").innerHTML += "<li id='set_Item"+i+"'> <a href='javascript:void(0)'> "+jsonLista.puzzle['linea_'+i].contenido+"</a> </li>";
        var ul = document.querySelector('ul');
        //Randomize
        for (var i = ul.children.length; i >= 0; i--)
        {
            ul.appendChild(ul.children[Math.random() * i | 0]);
        }
        puzzle= $('#puzzle').nestedSortable(
            {
                forcePlaceholderSize: true,
                handle: 'a',
                items: 'li',
				listType: 'ul',
                opacity: .6,
                maxLevels: 10,

            });
        $('#serialize').click(function(){
            arraied = $('#puzzle').nestedSortable('toArray');
            var s =arraied

            var cols = [];
            for (var k in s) {
                for (var c in s[k]) {
                    if (cols.indexOf(c)===-1) cols.push(c);
                }
            }
            var html = '<table class="table table-responsive"><tr>'+
                cols.map(function(c){ return '<th>'+c+'</th>' }).join('')+
                '</tr>';
            for (var l in s) {
                html += '<tr>'+
                    cols.map(function(c){ return '<td>'+(s[l][c]||'')+'</td>' }).join('')+
                    '</tr>';
            }
            html += '</table>';

            $("#toArrayOutput").html(html);
			toHierarchy=$("#puzzle").nestedSortable('toHierarchy');
			$("#toHierarchy").html(toHierarchy);
			$("#serialize").html($("#puzzle").nestedSortable('serialize'));
			

        });

    });

    function dump(arr,level) {
        var dumped_text = "";
        if(!level) level = 0;

        //The padding given at the beginning of the line.
        var level_padding = "";
        for(var j=0;j<level+1;j++) level_padding += "    ";

        if(typeof(arr) == 'object') { //Array/Hashes/Objects
            for(var item in arr) {
                var value = arr[item];

                if(typeof(value) == 'object') { //If it is an array,
                    dumped_text += level_padding + "'" + item + "' ...\n";
                    dumped_text += dump(value,level+1);
                } else {
                    dumped_text += level_padding + "'" + item + "' => \"" + value + "\"\n";
                }
            }
        } else { //Strings/Chars/Numbers etc.
            dumped_text = "===>"+arr+"<===("+typeof(arr)+")";
        }
        return dumped_text;
    }
	function textAreaAdjust(o)
	{
		o.style.height = "1px";
		o.style.height = (25+o.scrollHeight)+"px";
	}
</script>

	</body>
</html>